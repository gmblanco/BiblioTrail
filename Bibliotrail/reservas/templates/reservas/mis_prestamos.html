{% extends "BibliotrailApp/base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Mis Préstamos</h2>

    <div class="mb-5">
        <h4>Préstamos activos</h4>
        {% if prestamos_activos %}
            <div class="row">
                {% for prestamo in prestamos_activos %}
                <div class="col-12 mb-3">
                    <div class="card shadow-sm" style="background-color: #f0f4fa; font-size: 0.9rem;">
                      <div class="row g-0 align-items-center">
                        <!-- Portada -->
                        <div class="col-3 col-sm-2 col-md-2 d-flex justify-content-center">
                          {% if prestamo.portada %}
                            <img src="{{ prestamo.portada }}" class="img-fluid rounded-start p-2" alt="Portada del libro" style="max-height: 160px; object-fit: contain;">
                          {% else %}
                            <img src="https://via.placeholder.com/120x160" class="img-fluid rounded-start p-2" alt="Portada no disponible" style="max-height: 160px;">
                          {% endif %}
                        </div>
                  
                        <!-- Información principal con separador a la derecha -->
                        <div class="col-7 col-sm-8 col-md-8 border-end" style="padding: 12px 16px;">
                          <h5 class="card-title mb-2">{{ prestamo.titulo_libro }}</h5>
                          <p class="mb-1"><strong>Autor:</strong> {{ prestamo.autor|default:"No disponible" }}</p>
                          <p class="mb-1"><strong>Editorial:</strong> {{ prestamo.editorial|default:"-" }}</p>
                        </div>
                  
                        <!-- Zona lateral: fechas  -->
                        <div class="col-2 d-flex flex-column justify-content-center align-items-center p-2 text-center">
                          <small><strong>Reservado:</strong><br>{{ prestamo.fecha_prestamo }}</small>
                          <small class="mt-1" style="color: red;"><strong>Caduca:</strong><br>{{ prestamo.fecha_limite }}</small>
                          {% if prestamo.estado == 'r' %}
                            <small class="text-danger mt-1">Retrasado</small>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  </div>
                                 
                {% endfor %}
            </div>
        {% else %}
            <p>No tienes préstamos activos actualmente.</p>
        {% endif %}
    </div>
    

    <div class="mb-5">
        <h4>Préstamos retrasados</h4>
        {% if prestamos_retrasados %}
            <ul class="list-group">
                {% for prestamo in prestamos_retrasados %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <strong>{{ prestamo.titulo_libro }}</strong>
                        <span style="color: red;">
                            Vencía: {{ prestamo.fecha_limite|default:"Desconocida" }}
                        </span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No hay préstamos retrasados.</p>
        {% endif %}
    </div>

    <div>
        <h4>Préstamos devueltos</h4>
        {% if prestamos_devueltos %}
            <ul class="list-group">
                {% for prestamo in prestamos_devueltos %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <strong>{{ prestamo.titulo_libro }}</strong>
                        <span>
                            Devuelto el: {{ prestamo.fecha_devolucion }}
                        </span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No has devuelto ningún libro todavía.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
