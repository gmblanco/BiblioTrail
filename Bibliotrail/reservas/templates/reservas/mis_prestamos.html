{% extends "BibliotrailApp/base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4 mb-5">

    <h2 class="fw-bold mb-4" style="color: #4a77d4;">
        <i class="bi bi-journal-bookmark-fill me-2"></i>Mis Préstamos
    </h2>

    <!-- Préstamos activos -->
    <div class="mb-5">
        <h4 class="mb-3 text-secondary border-bottom pb-1">Préstamos activos</h4>
        {% if prestamos_activos %}
            <div class="row gy-4">
                {% for prestamo in prestamos_activos %}
                <div class="col-12">
                    <div class="card shadow-sm border-0 bg-light-subtle" style="font-size: 0.9rem;">
                        <div class="row g-0 align-items-center">
                            
                            <!-- Portada -->
                            <div class="col-3 col-sm-2 col-md-2 d-flex justify-content-center">
                                {% if prestamo.portada %}
                                    <img src="{{ prestamo.portada }}" class="img-fluid rounded-start p-2" alt="Portada del libro" style="max-height: 160px; object-fit: contain;">
                                {% else %}
                                    <img src="https://via.placeholder.com/120x160" class="img-fluid rounded-start p-2" alt="Portada no disponible" style="max-height: 160px;">
                                {% endif %}
                            </div>

                            <!-- Información -->
                            <div class="col-7 col-sm-8 col-md-8 border-end" style="padding: 12px 16px;">
                                <h5 class="card-title mb-2 text-dark fw-semibold">{{ prestamo.titulo_libro }}</h5>
                                <p class="mb-1 text-muted"><strong>Autor:</strong> {{ prestamo.autor|default:"No disponible" }}</p>
                                <p class="mb-0 text-muted"><strong>Editorial:</strong> {{ prestamo.editorial|default:"-" }}</p>
                            </div>

                            <!-- Fechas -->
                            <div class="col-2 d-flex flex-column justify-content-center align-items-center p-2 text-center">
                                <small><strong>Reservado:</strong><br>{{ prestamo.fecha_prestamo }}</small>
                                <small class="mt-2 text-danger"><strong>Caduca:</strong><br>{{ prestamo.fecha_limite }}</small>
                                {% if prestamo.estado == 'r' %}
                                    <small class="text-danger fw-bold mt-2">Retrasado</small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-muted">No tienes préstamos activos actualmente.</p>
        {% endif %}
    </div>

    <!-- Préstamos retrasados -->
    <div class="mb-5">
        <h4 class="mb-3 text-secondary border-bottom pb-1">Préstamos retrasados</h4>
        {% if prestamos_retrasados %}
            <ul class="list-group shadow-sm">
                {% for prestamo in prestamos_retrasados %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <strong class="text-dark">{{ prestamo.titulo_libro }}</strong>
                        <span class="text-danger fw-semibold">
                            Vencía: {{ prestamo.fecha_limite|default:"Desconocida" }}
                        </span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-muted">No hay préstamos retrasados.</p>
        {% endif %}
    </div>

    <!-- Préstamos devueltos -->
    <div>
        <h4 class="mb-3 text-secondary border-bottom pb-1">Préstamos devueltos</h4>
        {% if prestamos_devueltos %}
            <ul class="list-group shadow-sm">
                {% for prestamo in prestamos_devueltos %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <strong class="text-dark">{{ prestamo.titulo_libro }}</strong>
                        <span class="text-muted small">
                            Devuelto el: {{ prestamo.fecha_devolucion }}
                        </span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-muted">No has devuelto ningún libro todavía.</p>
        {% endif %}
    </div>

</div>
{% endblock %}
